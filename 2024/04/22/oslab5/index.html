<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","Sidebar Display (only for Muse | Mist), available values":["always  expand for all pages automatically."],"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="title:SYSU-2024æ“ä½œç³»ç»Ÿlab3å®éªŒæŠ¥å‘Š date:2024-04-28 23:54:26 tags:os comments:true author:zyhå®éªŒåç§°:          Lab5 å†…æ ¸çº¿ç¨‹å­¦ç”Ÿå§“å:                    åº„äº‘çš“ å­¦ç”Ÿå­¦å·:                   22336327 å®éªŒæˆç»©: æŠ¥å‘Šæ—¶é—´:">
<meta property="og:type" content="article">
<meta property="og:title" content="yhzhuang">
<meta property="og:url" content="http://example.com/2024/04/22/oslab5/index.html">
<meta property="og:site_name" content="yhzhuang">
<meta property="og:description" content="title:SYSU-2024æ“ä½œç³»ç»Ÿlab3å®éªŒæŠ¥å‘Š date:2024-04-28 23:54:26 tags:os comments:true author:zyhå®éªŒåç§°:          Lab5 å†…æ ¸çº¿ç¨‹å­¦ç”Ÿå§“å:                    åº„äº‘çš“ å­¦ç”Ÿå­¦å·:                   22336327 å®éªŒæˆç»©: æŠ¥å‘Šæ—¶é—´:">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714812925884.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714905739957.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714908742419.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714840614902.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714909688608.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714909446513.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714909863122.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714910381025.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714910209537.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714911275547.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714911725209.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714912484030.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714913439195.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714913635709.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714914114783.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714908659141.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714919664301.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714917101307.png">
<meta property="og:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714917971082.png">
<meta property="article:published_time" content="2024-04-22T03:06:50.967Z">
<meta property="article:modified_time" content="2024-05-06T03:09:22.849Z">
<meta property="article:author" content="zyh">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/04/22/oslab5/oslab5/1714812925884.png">

<link rel="canonical" href="http://example.com/2024/04/22/oslab5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title> | yhzhuang</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">yhzhuang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>resources</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/22/oslab5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yhzhuang">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-22 11:06:50" itemprop="dateCreated datePublished" datetime="2024-04-22T11:06:50+08:00">2024-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-06 11:09:22" itemprop="dateModified" datetime="2024-05-06T11:09:22+08:00">2024-05-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <hr>
<p>title:SYSU-2024æ“ä½œç³»ç»Ÿlab3å®éªŒæŠ¥å‘Š</p>
<p>date:2024-04-28 23:54:26</p>
<p>tags:os</p>
<p>comments:true</p>
<h2 id="author-zyh"><a href="#author-zyh" class="headerlink" title="author:zyh"></a>author:zyh</h2><h1 id="å®éªŒåç§°-Lab5-å†…æ ¸çº¿ç¨‹"><a href="#å®éªŒåç§°-Lab5-å†…æ ¸çº¿ç¨‹" class="headerlink" title="å®éªŒåç§°:          Lab5 å†…æ ¸çº¿ç¨‹"></a>å®éªŒåç§°:          Lab5 å†…æ ¸çº¿ç¨‹</h1><p>å­¦ç”Ÿå§“å:                    åº„äº‘çš“</p>
<p>å­¦ç”Ÿå­¦å·:                   22336327</p>
<p>å®éªŒæˆç»©:</p>
<p>æŠ¥å‘Šæ—¶é—´:                   2023-5-5</p>
<h2 id="1-å®éªŒè¦æ±‚"><a href="#1-å®éªŒè¦æ±‚" class="headerlink" title="1. å®éªŒè¦æ±‚"></a>1. <strong>å®éªŒè¦æ±‚</strong></h2><h3 id="Assignment-1-printfçš„å®ç°"><a href="#Assignment-1-printfçš„å®ç°" class="headerlink" title="Assignment 1 printfçš„å®ç°"></a>Assignment 1 printfçš„å®ç°</h3><p>å­¦ä¹ å¯å˜å‚æ•°æœºåˆ¶ï¼Œç„¶åå®ç°printfï¼Œä½ å¯ä»¥åœ¨ææ–™ä¸­çš„printfä¸Šè¿›è¡Œæ”¹è¿›ï¼Œæˆ–è€…ä»å¤´å¼€å§‹å®ç°è‡ªå·±çš„printfå‡½æ•°ã€‚ç»“æœæˆªå›¾å¹¶è¯´è¯´ä½ æ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<h3 id="Assignment-2-çº¿ç¨‹çš„å®ç°"><a href="#Assignment-2-çº¿ç¨‹çš„å®ç°" class="headerlink" title="Assignment 2 çº¿ç¨‹çš„å®ç°"></a>Assignment 2 çº¿ç¨‹çš„å®ç°</h3><p>è‡ªè¡Œè®¾è®¡PCBï¼Œå¯ä»¥æ·»åŠ æ›´å¤šçš„å±æ€§ï¼Œå¦‚ä¼˜å…ˆçº§ç­‰ï¼Œç„¶åæ ¹æ®ä½ çš„PCBæ¥å®ç°çº¿ç¨‹ï¼Œæ¼”ç¤ºæ‰§è¡Œç»“æœã€‚</p>
<h3 id="Assignment-3-çº¿ç¨‹è°ƒåº¦åˆ‡æ¢çš„ç§˜å¯†"><a href="#Assignment-3-çº¿ç¨‹è°ƒåº¦åˆ‡æ¢çš„ç§˜å¯†" class="headerlink" title="Assignment 3 çº¿ç¨‹è°ƒåº¦åˆ‡æ¢çš„ç§˜å¯†"></a>Assignment 3 çº¿ç¨‹è°ƒåº¦åˆ‡æ¢çš„ç§˜å¯†</h3><p>æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œçš„ç§˜å¯†åœ¨äºæˆ‘ä»¬éœ€è¦ä¸­æ–­çº¿ç¨‹çš„æ‰§è¡Œï¼Œä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œç„¶åè°ƒåº¦ä¸‹ä¸€ä¸ªçº¿ç¨‹ä¸Šå¤„ç†æœºï¼Œæœ€åä½¿è¢«è°ƒåº¦ä¸Šå¤„ç†æœºçš„çº¿ç¨‹ä»ä¹‹å‰è¢«ä¸­æ–­ç‚¹å¤„æ¢å¤æ‰§è¡Œã€‚ç°åœ¨ï¼ŒåŒå­¦ä»¬å¯ä»¥äº²æ‰‹æ­å¼€è¿™ä¸ªç§˜å¯†ã€‚</p>
<p>ç¼–å†™è‹¥å¹²ä¸ªçº¿ç¨‹å‡½æ•°ï¼Œä½¿ç”¨gdbè·Ÿè¸ª <code>c_time_interrupt_handler</code>ã€<code>asm_switch_thread</code>ç­‰å‡½æ•°ï¼Œè§‚å¯Ÿçº¿ç¨‹åˆ‡æ¢å‰åæ ˆã€å¯„å­˜å™¨ã€PCç­‰å˜åŒ–ï¼Œç»“åˆgdbã€ææ–™ä¸­â€œçº¿ç¨‹çš„è°ƒåº¦â€çš„å†…å®¹æ¥è·Ÿè¸ªå¹¶è¯´æ˜ä¸‹é¢ä¸¤ä¸ªè¿‡ç¨‹ã€‚</p>
<ul>
<li>ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«è°ƒåº¦ç„¶åå¼€å§‹æ‰§è¡Œçš„ã€‚</li>
<li>ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«ä¸­æ–­ç„¶åè¢«æ¢ä¸‹å¤„ç†å™¨çš„ï¼Œä»¥åŠæ¢ä¸Šå¤„ç†æœºååˆæ˜¯å¦‚ä½•ä»è¢«ä¸­æ–­ç‚¹å¼€å§‹æ‰§è¡Œçš„ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šé¢è¿™ä¸ªç»ƒä¹ ï¼ŒåŒå­¦ä»¬åº”è¯¥èƒ½å¤Ÿè¿›ä¸€æ­¥ç†è§£æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œçš„ã€‚</p>
<h3 id="ï¼ˆå¿…åšä¸é€‰åšï¼‰Assignment-4-è°ƒåº¦ç®—æ³•çš„å®ç°"><a href="#ï¼ˆå¿…åšä¸é€‰åšï¼‰Assignment-4-è°ƒåº¦ç®—æ³•çš„å®ç°" class="headerlink" title="ï¼ˆå¿…åšä¸é€‰åšï¼‰Assignment 4 è°ƒåº¦ç®—æ³•çš„å®ç°"></a>ï¼ˆå¿…åšä¸é€‰åšï¼‰Assignment 4 è°ƒåº¦ç®—æ³•çš„å®ç°</h3><p>åœ¨ææ–™ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨æ—¶é—´ç‰‡è½®è½¬ç®—æ³•æ¥å®ç°çº¿ç¨‹è°ƒåº¦ã€‚ä½†çº¿ç¨‹è°ƒåº¦ç®—æ³•ä¸æ­¢ä¸€ç§ï¼Œä¾‹å¦‚</p>
<ul>
<li>å…ˆæ¥å…ˆæœåŠ¡ã€‚</li>
<li>æœ€çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰ä¼˜å…ˆã€‚</li>
<li>å“åº”æ¯”æœ€é«˜è€…ä¼˜å…ˆç®—æ³•ã€‚</li>
<li>ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚</li>
<li>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬çš„è°ƒåº¦ç®—æ³•è¿˜å¯ä»¥æ˜¯æŠ¢å å¼çš„ã€‚</p>
<p>ç°åœ¨ï¼ŒåŒå­¦ä»¬éœ€è¦å°†çº¿ç¨‹è°ƒåº¦ç®—æ³•ä¿®æ”¹ä¸ºä¸Šé¢æåˆ°çš„ç®—æ³•æˆ–è€…æ˜¯åŒå­¦ä»¬è‡ªå·±è®¾è®¡çš„ç®—æ³•ã€‚ç„¶åï¼ŒåŒå­¦ä»¬éœ€è¦è‡ªè¡Œç¼–å†™æµ‹è¯•æ ·ä¾‹æ¥å‘ˆç°ä½ çš„ç®—æ³•å®ç°çš„æ­£ç¡®æ€§å’ŒåŸºæœ¬é€»è¾‘ã€‚æœ€åï¼Œå°†ç»“æœæˆªå›¾å¹¶è¯´è¯´ä½ æ˜¯æ€ä¹ˆåšçš„ã€‚<strong>ï¼ˆå…ˆæ¥å…ˆæœåŠ¡ä¸ºå¿…åšï¼Œå…¶ä»–ä¸ºé€‰åšï¼‰</strong></p>
<p>å‚è€ƒèµ„æ–™ï¼š<a href="https://gitee.com/link?target=https://zhuanlan.zhihu.com/p/97071815">https://zhuanlan.zhihu.com/p/97071815</a></p>
<p>Tipsï¼š</p>
<ul>
<li>å…ˆæ¥å…ˆæœåŠ¡æœ€ç®€å•ã€‚</li>
<li>æœ‰äº›è°ƒåº¦ç®—æ³•çš„å®ç°<strong>å¯èƒ½éœ€è¦</strong>ç”¨åˆ°ä¸­æ–­ã€‚</li>
</ul>
<h2 id="2-å®éªŒè¿‡ç¨‹"><a href="#2-å®éªŒè¿‡ç¨‹" class="headerlink" title="2. å®éªŒè¿‡ç¨‹"></a>2. <strong>å®éªŒè¿‡ç¨‹</strong></h2><h3 id="Assignment-1"><a href="#Assignment-1" class="headerlink" title="Assignment 1"></a>Assignment 1</h3><h4 id="1-1å¯å˜å‚æ•°æœºåˆ¶"><a href="#1-1å¯å˜å‚æ•°æœºåˆ¶" class="headerlink" title="1.1å¯å˜å‚æ•°æœºåˆ¶"></a>1.1å¯å˜å‚æ•°æœºåˆ¶</h4><p>å®ç°è¿™äº›å®</p>
<table>
<thead>
<tr>
<th>å®</th>
<th>ç”¨æ³•è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>va_list</code></td>
<td>å®šä¹‰ä¸€ä¸ªæŒ‡å‘å¯å˜å‚æ•°åˆ—è¡¨çš„æŒ‡é’ˆã€‚</td>
</tr>
<tr>
<td><code>void va_start(va_list ap, last_arg)</code></td>
<td>åˆå§‹åŒ–å¯å˜å‚æ•°åˆ—è¡¨æŒ‡é’ˆ <code>ap</code>ï¼Œä½¿å…¶æŒ‡å‘å¯å˜å‚æ•°åˆ—è¡¨çš„èµ·å§‹ä½ç½®ï¼Œå³å‡½æ•°çš„å›ºå®šå‚æ•°åˆ—è¡¨çš„æœ€åä¸€ä¸ªå‚æ•° <code>last_arg</code>çš„åé¢ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</td>
</tr>
<tr>
<td><code>type va_arg(va_list ap, type)</code></td>
<td>ä»¥ç±»å‹ <code>type</code>è¿”å›å¯å˜å‚æ•°ï¼Œå¹¶ä½¿ <code>ap</code>æŒ‡å‘ä¸‹ä¸€ä¸ªå‚æ•°ã€‚</td>
</tr>
<tr>
<td><code>void va_end(va_list ap)</code></td>
<td>æ¸…é›¶ <code>ap</code>ã€‚</td>
</tr>
</tbody></table>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> *va_list;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _INTSIZEOF(n) ((sizeof(n) + sizeof(int) - 1) &amp; ~(sizeof(int) - 1))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> va_start(ap, v) (ap = (va_list)&amp;v + _INTSIZEOF(v))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> va_arg(ap, type) (*(type *)((ap += _INTSIZEOF(type)) - _INTSIZEOF(type)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> va_end(ap) (ap = (va_list)0)</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œçš„ _INTSIZIOF: ~(sizeof(int) - 1)ä¸º0xfffffffc ,ä»»ä½•åœ°å€ä¸å®ƒ&amp;åå°†ä½ä¸¤ä½æ¸…é›¶ï¼Œä¸ºäº†å®ç°å‘ä¸Šå¯¹é½ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåŠ ä¸Š(sizeof(int)-1)åå†å’Œ0xfffffffcç›¸ä¸ï¼Œæ­¤æ—¶å¾—åˆ°çš„ç»“æœå°±æ˜¯å‘ä¸Š4å­—èŠ‚å¯¹é½çš„ã€‚</p>
<h4 id="1-2-å®ç°printfå¢åŠ -bå’Œ-fåŠŸèƒ½"><a href="#1-2-å®ç°printfå¢åŠ -bå’Œ-fåŠŸèƒ½" class="headerlink" title="1.2 å®ç°printfå¢åŠ %bå’Œ%fåŠŸèƒ½"></a>1.2 å®ç°printfå¢åŠ %bå’Œ%fåŠŸèƒ½</h4><p>å®ç°äº†print(â€œ%b,n),jå’Œprint(â€œ%fâ€,n),åˆ†åˆ«å°†iä»¥2è¿›åˆ¶å’Œfloatæµ®ç‚¹æ•°ï¼Œä¿ç•™å…­ä½å°æ•°è¾“å‡º</p>
<p>è®©æˆ‘ä»¬å…ˆè§£é‡Šä¸€ä¸‹printfå®ç°çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°å¯å˜å‚æ•°æœºåˆ¶ï¼Œ</p>
<p>è§£é‡Šä¸€ä¸‹printfä¸­çš„ä»£ç ï¼š</p>
<p>å¦‚æœ % çš„ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯â€™\0â€™ï¼Œåˆ™é€€å‡ºï¼›å¦‚æœæ˜¯â€™câ€™ï¼Œåˆ™ä»¥å­—ç¬¦çš„æ ¼å¼è¿”å›ä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ï¼Œå¹¶å°†å…¶åŠ å…¥ç¼“å†²åŒºï¼›å¦‚æœæ˜¯â€™sâ€™ï¼Œåˆ™è¾“å‡ºå¹¶æ¸…ç©ºç¼“å†²åŒºï¼Œå¹¶ä»¥char*çš„æ ¼å¼è¿”å›ä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ï¼Œå¹¶ç›´æ¥æ‰“å°ï¼›å¦‚æœæ˜¯â€™dâ€™ï¼Œåˆ™ä»¥intçš„æ ¼å¼è¿”å›ä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²ååŠ å…¥ç¼“å†²åŒºï¼›å¦‚æœæ˜¯â€™xâ€™ï¼Œåˆ™ä»¥intçš„æ ¼å¼è¿”å›ä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ï¼Œè¿›è¡Œè¿›åˆ¶è½¬æ¢ï¼Œç„¶åè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ŒåŠ å…¥ç¼“å†²åŒºï¼›</p>
<p>%bçš„å®ç°åªéœ€æŠŠ%xä¸­çš„itos(number, temp, (fmt[i] &#x3D;&#x3D; â€˜dâ€™ ? 10 : 16));æ”¹æˆitos(number, temp, (fmt[i] &#x3D;&#x3D; â€˜dâ€™ ? 10 : 2));</p>
<p>%fçš„å®ç°å‚è€ƒäº†<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44078824/article/details/118440458">printfçš„å®ç°</a></p>
<p>ç®€å•åœ°è¯´ï¼Œå…ˆæŠŠæµ®ç‚¹æ•°åˆ†æˆæ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼Œç„¶åå°†æ•´æ•°å’Œå°æ•°åˆ†åˆ«è½¬æ¢ä¸ºå•ä¸ªå­—ç¬¦æ‰“å°ã€‚å› ä¸ºæ˜¯ä¿ç•™å…­ä½å°æ•°ï¼Œå°æ•°å…ˆ*1000000å†æŒ‰æ•´æ•°æ–¹å¼æ¥æ‰“å°ï¼Œå…·ä½“ä»£ç è§å…³é”®ä»£ç éƒ¨åˆ†</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;print percentage: %%\n&quot;</span></span><br><span class="line">           <span class="string">&quot;print char \&quot;N\&quot;: %c\n&quot;</span></span><br><span class="line">           <span class="string">&quot;print string \&quot;Hello World!\&quot;: %s\n&quot;</span></span><br><span class="line">           <span class="string">&quot;print decimal: \&quot;-1234\&quot;: %d\n&quot;</span></span><br><span class="line">           <span class="string">&quot;print hexadecimal \&quot;0x7abcdef0\&quot;: %x\n&quot;</span></span><br><span class="line">           <span class="string">&quot;print binary \&quot;0b10\&quot;: %b\n&quot;</span></span><br><span class="line">           <span class="string">&quot;print float \&quot;3.1415\&quot;: %f\n&quot;</span>,</span><br><span class="line">           <span class="string">&#x27;N&#x27;</span>, <span class="string">&quot;Hello World!&quot;</span>, <span class="number">-1234</span>, <span class="number">0x7abcdef0</span>, <span class="number">0b10</span>,<span class="number">3.1415</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Assignment-2"><a href="#Assignment-2" class="headerlink" title="Assignment 2"></a>Assignment 2</h3><h4 id="çº¿ç¨‹çš„æè¿°"><a href="#çº¿ç¨‹çš„æè¿°" class="headerlink" title="çº¿ç¨‹çš„æè¿°"></a>çº¿ç¨‹çš„æè¿°</h4><p>å…ˆä»‹ç»ä¸€ä¸‹è¿›ç¨‹æ§åˆ¶å—PCB:</p>
<p>åœ¨å®éªŒä¸­ç”¨ä¸€ä¸ªç»“æ„ä½“è¡¨ç¤ºï¼ŒåŒ…æ‹¬æ ˆæŒ‡é’ˆï¼Œçº¿ç¨‹åï¼ŒçŠ¶æ€ï¼Œä¼˜å…ˆçº§ï¼Œçº¿ç¨‹idç­‰å†…å®¹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PCB</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> *stack;                      <span class="comment">// æ ˆæŒ‡é’ˆï¼Œç”¨äºè°ƒåº¦æ—¶ä¿å­˜esp</span></span><br><span class="line">    <span class="type">char</span> name[MAX_PROGRAM_NAME + <span class="number">1</span>]; <span class="comment">// çº¿ç¨‹å</span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">ProgramStatus</span> status;       <span class="comment">// çº¿ç¨‹çš„çŠ¶æ€</span></span><br><span class="line">    <span class="type">int</span> priority;                    <span class="comment">// çº¿ç¨‹ä¼˜å…ˆçº§</span></span><br><span class="line">    <span class="type">int</span> pid;                         <span class="comment">// çº¿ç¨‹pid</span></span><br><span class="line">    <span class="type">int</span> ticks;                       <span class="comment">// çº¿ç¨‹æ—¶é—´ç‰‡æ€»æ—¶é—´</span></span><br><span class="line">    <span class="type">int</span> ticksPassedBy;               <span class="comment">// çº¿ç¨‹å·²æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">    ListItem tagInGeneralList;       <span class="comment">// çº¿ç¨‹é˜Ÿåˆ—æ ‡è¯†</span></span><br><span class="line">    ListItem tagInAllList;           <span class="comment">// çº¿ç¨‹é˜Ÿåˆ—æ ‡è¯†</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šå‡ ä¸ªå˜é‡çš„å«ä¹‰ï¼š<br>ticksæ˜¯çº¿ç¨‹å‰©ä½™çš„æ‰§è¡Œæ¬¡æ•°ã€‚åœ¨æ—¶é—´ç‰‡è°ƒåº¦ç®—æ³•ä¸­ï¼Œæ¯å‘ç”Ÿä¸­æ–­ä¸€æ¬¡è®°ä¸ºä¸€ä¸ªtickï¼Œå½“ticks&#x3D;0æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«æ¢ä¸‹å¤„ç†å™¨ï¼Œç„¶åå°†å…¶ä»–çº¿ç¨‹æ¢ä¸Šå¤„ç†å™¨æ‰§è¡Œã€‚</p>
<p>ticksPassedByæ˜¯çº¿ç¨‹æ€»å…±æ‰§è¡Œçš„tickçš„æ¬¡æ•°ã€‚</p>
<p>tagInGeneralListå’ŒtagInAllListæ˜¯çº¿ç¨‹åœ¨çº¿ç¨‹é˜Ÿåˆ—ä¸­çš„æ ‡è¯†ï¼Œç”¨äºåœ¨çº¿ç¨‹é˜Ÿåˆ—ä¸­æ‰¾åˆ°çº¿ç¨‹çš„PCBã€‚è¿™ä¸¤ä¸ªå˜é‡çš„lListItemç±»å‹è¡¨ç¤ºé˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­ä¸¤ä¸ªæŒ‡é’ˆå˜é‡åˆ†åˆ«æŒ‡å‘å‰é¢å’Œåé¢çš„å…ƒç´ ã€‚ç”¨é“¾è¡¨æ¥å®ç°è¿›ç¨‹é˜Ÿåˆ—ï¼Œé“¾è¡¨ç»“æ„è¯¦è§ â€˜include&#x2F;list.hâ€™</p>
<p>stackçº¿ç¨‹æ ˆè¡¨ç¤ºå¦‚ä¸‹</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714812925884.png" alt="1714812925884"></p>
<p>å¯¹è®¸å¤šçº¿ç¨‹ç®¡ç†æˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªå£°æ˜ä¸€ä¸ªç¨‹åºç®¡ç†ç±» <code>ProgramManager.</code></p>
<p>ç”¨äºçº¿ç¨‹å’Œè¿›ç¨‹çš„åˆ›å»ºå’Œç®¡ç†ï¼Œä»£ç è§ <code>include/program.h</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PROGRAM_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROGRAM_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProgramManager</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h4 id="çº¿ç¨‹çš„åˆ›å»ºï¼š"><a href="#çº¿ç¨‹çš„åˆ›å»ºï¼š" class="headerlink" title="çº¿ç¨‹çš„åˆ›å»ºï¼š"></a>çº¿ç¨‹çš„åˆ›å»ºï¼š</h4><p>1.æˆ‘ä»¬åœ¨ <code>include/program.h</code>ä¸­å¯¹ç¨‹åºç®¡ç†ç±» <code>ProgramManager</code>ä¸­çš„å˜é‡å’Œå‡½æ•°è¿›è¡Œå£°æ˜ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProgramManager</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    List allPrograms;   <span class="comment">// æ‰€æœ‰çŠ¶æ€çš„çº¿ç¨‹/è¿›ç¨‹çš„é˜Ÿåˆ—</span></span><br><span class="line">    List readyPrograms; <span class="comment">// å¤„äºready(å°±ç»ªæ€)çš„çº¿ç¨‹/è¿›ç¨‹çš„é˜Ÿåˆ—</span></span><br><span class="line">    PCB *running;       <span class="comment">// å½“å‰æ‰§è¡Œçš„çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ProgramManager</span>();</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ”¾å…¥å°±ç»ªé˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// functionï¼šçº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    <span class="comment">// parameterï¼šæŒ‡å‘å‡½æ•°çš„å‚æ•°çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// nameï¼šçº¿ç¨‹çš„åç§°</span></span><br><span class="line">    <span class="comment">// priorityï¼šçº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆåŠŸï¼Œè¿”å›pidï¼›å¤±è´¥ï¼Œè¿”å›-1</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">executeThread</span><span class="params">(ThreadFunction function, <span class="type">void</span> *parameter, <span class="type">const</span> <span class="type">char</span> *name, <span class="type">int</span> priority)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†é…ä¸€ä¸ªPCB</span></span><br><span class="line">    <span class="function">PCB *<span class="title">allocatePCB</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// å½’è¿˜ä¸€ä¸ªPCB</span></span><br><span class="line">    <span class="comment">// programï¼šå¾…é‡Šæ”¾çš„PCB</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">releasePCB</span><span class="params">(PCB *program)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œçº¿ç¨‹è°ƒåº¦</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">schedule</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// zu se huan xing</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">MESA_WakeUp</span><span class="params">(PCB *program)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">program_exit</span><span class="params">()</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.å‘å†…å­˜ç”³è¯·PCBç©ºé—´ï¼ˆä»¥ä¸‹å†…å®¹è§src&#x2F;kernel&#x2F;program.cpp)</p>
<p>ï¼ˆ1ï¼‰å£°æ˜PCBçš„ç©ºé—´å’ŒPCBåˆ†é…çŠ¶æ€æ•°ç»„</p>
<p>åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªPCB_SIZE * MAX_PROGRAM_AMOUNTä¸ªå­—èŠ‚çš„ç©ºé—´ç”¨äºåˆ†é…ç»™æ‰€æœ‰çº¿ç¨‹çš„thread-&gt;stackã€‚è¿™é‡Œæˆ‘ä»¬æŠŠPCBå¤§å°è®¾ç½®ä¸º4096ï¼ˆ4kb)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> PCB_SET[PCB_SIZE * MAX_PROGRAM_AMOUNT];<span class="comment">//MAX_PROGRAM_AMOUNTä¸ªPCBçš„å¤§å°ç©ºé—´</span></span><br></pre></td></tr></table></figure>

<p>å†ç”¨ä¸€ä¸ªboolç±»å‹æ•°ç»„è¡¨ç¤ºPCBåˆ†é…çŠ¶æ€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PCBçš„åˆ†é…çŠ¶æ€ï¼Œtrueè¡¨ç¤ºå·²ç»åˆ†é…ï¼Œfalseè¡¨ç¤ºæœªåˆ†é…ã€‚</span></span><br><span class="line"><span class="type">bool</span> PCB_SET_STATUS[MAX_PROGRAM_AMOUNT];   </span><br></pre></td></tr></table></figure>

<p>å¦‚æœå·²ç»ç»™ä¸€ä¸ªçº¿ç¨‹åˆ†é…äº†PCBåˆ™å°†è¯¥çº¿ç¨‹å¯¹åº”çš„PCB_SET_STATUSä¸­çš„æ•°ç½®1</p>
<p>ï¼ˆ2ï¼‰allocatePCBå’ŒreleasePCB</p>
<p>å…·ä½“è¿›è¡Œåˆ†é…çš„è¿‡ç¨‹æˆ‘ä»¬é€šè¿‡program_managerä¸­çš„å‡½æ•°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†é…ä¸€ä¸ªPCB</span></span><br><span class="line"><span class="function">PCB *<span class="title">allocatePCB</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// å½’è¿˜ä¸€ä¸ªPCB</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">releasePCB</span><span class="params">(PCB *program)</span></span>;</span><br></pre></td></tr></table></figure>

<p>æ¥å®ç°ã€‚ä¸¤ä¸ªå‡½æ•°å®ç°çš„ä»£ç æ”¾ç½®åœ¨ <code>src/kernel/program.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">PCB *<span class="title">ProgramManager::allocatePCB</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MAX_PROGRAM_AMOUNT; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!PCB_SET_STATUS[i])</span><br><span class="line">        &#123;</span><br><span class="line">            PCB_SET_STATUS[i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> (PCB *)((<span class="type">int</span>)PCB_SET + PCB_SIZE * i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°å¯¹PCB_SET_STATUSä¸­çš„å…ƒç´ ä¾æ¬¡åˆ¤æ–­çœ‹è¯¥ä½ç½®å¯¹åº”çš„PCB_SETç©ºé—´æ˜¯å¦å·²ç»è¢«ç±»é…äº†ï¼Œå¦‚æœæ²¡æœ‰æ²¡æœ‰åˆ™è¿”å›ç¬¬iä¸ªPCBçš„èµ·å§‹åœ°å€ï¼ˆå¯¹äºç¬¬ğ‘–ä¸ªPCBï¼Œ<code>PCB_SET</code>çš„é¦–åœ°å€åŠ ä¸Š<strong>i</strong>Ã—<strong>P</strong>C<strong>B</strong>S<strong>I</strong>Z<strong>E</strong>ğ‘–Ã—ğ‘ƒğ¶ğµğ‘†ğ¼ğ‘ğ¸å°±æ˜¯ç¬¬<strong>i</strong>ğ‘–ä¸ªPCBçš„èµ·å§‹åœ°å€ï¼‰</p>
<p>æœ‰PCBçš„åˆ†é…å°±æœ‰PCBçš„é‡Šæ”¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ProgramManager::releasePCB</span><span class="params">(PCB *program)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> index = ((<span class="type">int</span>)program - (<span class="type">int</span>)PCB_SET) / PCB_SIZE;</span><br><span class="line">    PCB_SET_STATUS[index] = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>releasePCB</code>æ¥å—ä¸€ä¸ªPCBæŒ‡é’ˆ <code>program</code>ï¼Œç„¶åè®¡ç®—å‡º <code>program</code>æŒ‡å‘çš„PCBåœ¨ <code>PCB_SET</code>ä¸­çš„ä½ç½®ï¼Œç„¶åå°† <code>PCB_SET_STATUS</code>ä¸­çš„å¯¹åº”ä½ç½®è®¾ç½® <code>false</code>å³å¯ã€‚</p>
<p>ï¼ˆ3ï¼‰excuteThreadçš„å®ç°</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬è§„å®šçº¿ç¨‹åªèƒ½æ‰§è¡Œè¿”å›å€¼ä¸ºvoidï¼Œå‚æ•°ä¸ºvoid *çš„å‡½æ•°<br>æˆ‘ä»¬åœ¨include&#x2F;Program.hä¸­å°†ä¸Šé¢æåˆ°çš„è¿™ä¸ªå‡½æ•°å®šä¹‰ä¸ºThreadFunctionã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(*ThreadFunction)</span><span class="params">(<span class="type">void</span> *)</span></span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨ProgramManagerç±»ä¸­å£°æ˜ä¸€ä¸ªç”¨äºåˆ›å»ºçº¿ç¨‹çš„å‡½æ•°executeThreadï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ”¾å…¥å°±ç»ªé˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// functionï¼šçº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    <span class="comment">// parameterï¼šæŒ‡å‘å‡½æ•°çš„å‚æ•°çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// nameï¼šçº¿ç¨‹çš„åç§°</span></span><br><span class="line">    <span class="comment">// priorityï¼šçº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span><br><span class="line">    <span class="comment">// æˆåŠŸï¼Œè¿”å›pidï¼›å¤±è´¥ï¼Œè¿”å›-1</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">executeThread</span><span class="params">(ThreadFunction function, <span class="type">void</span> *parameter, <span class="type">const</span> <span class="type">char</span> *name, <span class="type">int</span> priority)</span></span>;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨src&#x2F;kernel&#x2F;program.cppä¸­å®ç°executeThreadï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ProgramManager::executeThread</span><span class="params">(ThreadFunction function, <span class="type">void</span> *parameter, <span class="type">const</span> <span class="type">char</span> *name, <span class="type">int</span> priority)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å…³ä¸­æ–­ï¼Œé˜²æ­¢åˆ›å»ºçº¿ç¨‹çš„è¿‡ç¨‹è¢«æ‰“æ–­</span></span><br><span class="line">    <span class="type">bool</span> status = interruptManager.<span class="built_in">getInterruptStatus</span>();</span><br><span class="line">    interruptManager.<span class="built_in">disableInterrupt</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†é…ä¸€é¡µä½œä¸ºPCB</span></span><br><span class="line">    PCB *thread = <span class="built_in">allocatePCB</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!thread)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åˆ†é…çš„é¡µ</span></span><br><span class="line">    <span class="built_in">memset</span>(thread, <span class="number">0</span>, PCB_SIZE);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MAX_PROGRAM_NAME &amp;&amp; name[i]; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        thread-&gt;name[i] = name[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    thread-&gt;status = ProgramStatus::READY;</span><br><span class="line">    thread-&gt;priority = priority;</span><br><span class="line">    thread-&gt;ticks = priority * <span class="number">10</span>;</span><br><span class="line">    thread-&gt;ticksPassedBy = <span class="number">0</span>;</span><br><span class="line">    thread-&gt;pid = ((<span class="type">int</span>)thread - (<span class="type">int</span>)PCB_SET) / PCB_SIZE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ ˆ</span></span><br><span class="line">    thread-&gt;stack = (<span class="type">int</span> *)((<span class="type">int</span>)thread + PCB_SIZE);</span><br><span class="line">    thread-&gt;stack -= <span class="number">7</span>;</span><br><span class="line">    thread-&gt;stack[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    thread-&gt;stack[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    thread-&gt;stack[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    thread-&gt;stack[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">    thread-&gt;stack[<span class="number">4</span>] = (<span class="type">int</span>)function;</span><br><span class="line">    thread-&gt;stack[<span class="number">5</span>] = (<span class="type">int</span>)program_exit;</span><br><span class="line">    thread-&gt;stack[<span class="number">6</span>] = (<span class="type">int</span>)parameter;</span><br><span class="line"></span><br><span class="line">    allPrograms.<span class="built_in">push_back</span>(&amp;(thread-&gt;tagInAllList));</span><br><span class="line">    readyPrograms.<span class="built_in">push_back</span>(&amp;(thread-&gt;tagInGeneralList));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¢å¤ä¸­æ–­</span></span><br><span class="line">    interruptManager.<span class="built_in">setInterruptStatus</span>(status);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> thread-&gt;pid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç°åœ¨é€æ­¥åœ°åˆ†æçº¿ç¨‹åˆ›å»ºçš„é€»è¾‘ã€‚</p>
<p>ï¼ˆ1ï¼‰å…³ä¸­æ–­</p>
<p>3-5è¡Œä¿å­˜ä¸­æ–­çŠ¶æ€ç„¶åå…³ä¸­æ–­ï¼Œè¯¸å¦‚PCBåˆ†é…çš„å·¥ä½œå®é™…ä¸Šéƒ½éœ€è¦è¿›è¡Œçº¿ç¨‹äº’æ–¥å¤„ç†ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨å¼€å…³ä¸­æ–­å®ç°çº¿ç¨‹äº’æ–¥ä¸ºä»€ä¹ˆå¼€&#x2F;å…³ä¸­æ–­æœ‰æ•ˆå‘¢ï¼Ÿåœ¨åé¢å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ˜¯åœ¨æ—¶é’Ÿä¸­æ–­å‘ç”Ÿæ—¶æ¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦çš„ï¼Œå› æ­¤å…³ä¸­æ–­åï¼Œæ—¶é’Ÿä¸­æ–­æ— æ³•è¢«å“åº”ï¼Œçº¿ç¨‹å°±æ— æ³•è¢«è°ƒåº¦ï¼Œç›´åˆ°å†æ¬¡å¼€ä¸­æ–­ã€‚åªè¦çº¿ç¨‹æ— æ³•è¢«è°ƒåº¦ï¼Œé‚£ä¹ˆçº¿ç¨‹çš„å·¥ä½œä¹Ÿå°±æ— æ³•è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œå› æ­¤å°±å®ç°äº†çº¿ç¨‹äº’æ–¥ã€‚</p>
<p>å…³ä¸­æ–­åï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°è¿”å›å‰ï¼Œä¹Ÿå°±æ˜¯ç¬¬44è¡Œæ¢å¤ä¸­æ–­ã€‚</p>
<p>å¼€&#x2F;å…³ä¸­æ–­ç­‰ç›¸å…³çš„çš„å‡½æ•°å®šä¹‰åœ¨ <code>include/interrupt.h</code>ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InterruptManager</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€ä¸­æ–­</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enableInterrupt</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// å…³ä¸­æ–­</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">disableInterrupt</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// è·å–ä¸­æ–­çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// è¿”å›trueï¼Œä¸­æ–­å¼€å¯ï¼›è¿”å›falseï¼Œä¸­æ–­å…³é—­</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">getInterruptStatus</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// è®¾ç½®ä¸­æ–­çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// status=trueï¼Œå¼€ä¸­æ–­ï¼›status=falseï¼Œå…³ä¸­æ–­</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setInterruptStatus</span><span class="params">(<span class="type">bool</span> status)</span></span>;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œæ”¾ç½®åœ¨ <code>src/interrupt/interrupt.cpp</code>ä¸­ï¼Œè¿™é‡Œä¾¿ä¸å†èµ˜è¿°ï¼Œç°åœ¨æˆ‘ä»¬å›åˆ° <code>executeThread</code>ã€‚</p>
<p>ï¼ˆ2ï¼‰ç”³è¯·PCBç©ºé—´ï¼Œå¯¹PCBä¸­çš„å†…å®¹è¿›è¡Œåˆå§‹åŒ–</p>
<p>ç¬¬8è¡Œï¼Œå…³ä¸­æ–­åï¼Œæˆ‘ä»¬å‘ <code>PCB_SET</code>ç”³è¯·ä¸€ä¸ªçº¿ç¨‹çš„PCBï¼Œç„¶åæˆ‘ä»¬åœ¨ç¬¬14è¡Œä½¿ç”¨ <code>memeset</code>å°†PCBæ¸…0ã€‚<code>memeset</code>çš„å£°æ˜å’Œå®šä¹‰åˆ†åˆ«åœ¨ <code>include/stdlib.h</code>å’Œ <code>src/utils/stdlib.cpp</code>ã€‚</p>
<p>ç¬¬16-25è¡Œï¼Œæˆ‘ä»¬è®¾ç½®PCBçš„æˆå‘˜ <code>name</code>ã€<code>status</code>ã€<code>priority</code>ã€<code>ticks</code>ã€<code>ticksPassedBy</code>å’Œ <code>pid</code>ã€‚è¿™é‡Œï¼Œçº¿ç¨‹åˆå§‹çš„ <code>ticks</code>æˆ‘ä»¬ç®€å•åœ°è®¾ç½®ä¸º <code>10</code>å€çš„ <code>priority</code>ã€‚<code>pid</code>åˆ™ç®€å•åœ°ä½¿ç”¨PCBåœ¨ <code>PCB_SET</code>çš„ä½ç½®æ¥ä»£æ›¿ã€‚</p>
<p>ç¬¬28è¡Œï¼Œæˆ‘ä»¬åˆå§‹åŒ–çº¿ç¨‹çš„æ ˆã€‚æˆ‘ä»¬å°†æ ˆæ”¾ç½®åœ¨PCBä¸­ï¼Œè€Œçº¿ç¨‹çš„æ ˆæ˜¯ä»PCBçš„é¡¶éƒ¨å¼€å§‹å‘ä¸‹å¢é•¿çš„ï¼Œæ‰€ä»¥ä¸ä¼šä¸ä½äºPCBä½åœ°å€çš„ <code>name</code>å’Œ <code>pid</code>ç­‰å˜é‡å†²çªã€‚çº¿ç¨‹æ ˆçš„åˆå§‹åœ°å€æ˜¯PCBçš„èµ·å§‹åœ°å€åŠ ä¸Š <code>PCB_SIZE</code>ã€‚</p>
<p>ç¬¬29-36è¡Œï¼Œæˆ‘ä»¬åœ¨æ ˆä¸­æ”¾å…¥7ä¸ªæ•´æ•°å€¼ã€‚</p>
<ul>
<li>4ä¸ªä¸º0çš„å€¼æ˜¯è¦æ”¾åˆ°ebpï¼Œebxï¼Œediï¼Œesiä¸­çš„ã€‚</li>
<li><code>thread-&gt;stack[4]</code>æ˜¯çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°çš„èµ·å§‹åœ°å€ã€‚</li>
<li><code>thread-&gt;stack[5]</code>æ˜¯çº¿ç¨‹çš„è¿”å›åœ°å€ï¼Œæ‰€æœ‰çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åéƒ½ä¼šè¿”å›åˆ°è¿™ä¸ªåœ°å€ã€‚</li>
<li><code>thread-&gt;stack[6]</code>æ˜¯çº¿ç¨‹çš„å‚æ•°çš„åœ°å€ã€‚</li>
</ul>
<p>è‡³äºè¿™4éƒ¨ä»½çš„ä½œç”¨æˆ‘ä»¬åœ¨çº¿ç¨‹çš„è°ƒåº¦ä¸­ç»Ÿä¸€è®²è§£ã€‚</p>
<p>ï¼ˆ3ï¼‰å°†çº¿ç¨‹æ”¾è¿› <code>allPrograms</code>å’Œ <code>readyPrograms</code></p>
<p>åˆ›å»ºå®Œçº¿ç¨‹çš„PCBåï¼Œæˆ‘ä»¬å°†å…¶æ”¾å…¥åˆ° <code>allPrograms</code>å’Œ <code>readyPrograms</code>ä¸­ï¼Œç­‰å¾…æ—¶é’Ÿä¸­æ–­æ¥çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹å°±å¯ä»¥è¢«è°ƒåº¦ä¸Šå¤„ç†å™¨ã€‚</p>
<p>ï¼ˆ4)å¼€ä¸­æ–­</p>
<p>æœ€åæˆ‘ä»¬å°†ä¸­æ–­çš„çŠ¶æ€æ¢å¤ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¾¿åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<h3 id="Assignment-3"><a href="#Assignment-3" class="headerlink" title="Assignment 3"></a>Assignment 3</h3><h4 id="3-1ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«è°ƒåº¦ç„¶åå¼€å§‹æ‰§è¡Œ"><a href="#3-1ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«è°ƒåº¦ç„¶åå¼€å§‹æ‰§è¡Œ" class="headerlink" title="3.1ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«è°ƒåº¦ç„¶åå¼€å§‹æ‰§è¡Œ?"></a>3.1ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«è°ƒåº¦ç„¶åå¼€å§‹æ‰§è¡Œ?</h4><p>æˆ‘ä»¬æ¥çœ‹setup.cppä¸­è°ƒç”¨çš„æ±‡ç¼–å‡½æ•°asm_switch_thread(0, firstThread);<br>å°†å‚æ•°å’Œè¿”å›åœ°å€å‹æ ˆåï¼Œæˆ‘ä»¬å°† <code>ebp</code>ï¼Œ<code>ebx</code>ï¼Œ<code>edi</code>ï¼Œ<code>esi</code> ä¾æ¬¡å‹æ ˆï¼ˆå› ä¸ºè¿™å‡ ä¸ªå­˜å™¨çš„å€¼å¯èƒ½ä¼šåœ¨è¢«è°ƒå‡½æ•°ä¸­è¢«ä¿®æ”¹ï¼Œè¦å…ˆä¿æŠ¤èµ·æ¥ï¼‰ã€‚ç°åœ¨çš„æ ˆçŠ¶æ€å¦‚ä¸‹ï¼š</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714905739957.png" alt="1714905739957"></p>
<p>29è¡Œ[esp+5 * 4]è¡¨ç¤ºPCB * curè¿™ä¸ªæŒ‡é’ˆå˜é‡çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯æŒ‡å‘ç©ºé—´çš„åœ°å€ï¼‰ï¼ŒæŠŠå®ƒèµ‹å€¼ç»™eaxã€‚32è¡Œ[esp+6 * 4]åˆ™æ˜¯PCB *next.</p>
<p>æ³¨æ„30è¡Œä¿å­˜å½“å‰æ ˆæŒ‡é’ˆespåˆ°PCB::stackä¸­.[eax]å°±æ˜¯PCB * curè¿™ä¸ªæŒ‡é’ˆå˜é‡çš„å€¼, å› ä¸ºPCBç¬¬ä¸€ä¸ªå˜é‡å°±æ˜¯int <em><em>stack,[eax]å…¶å®å°±æ˜¯</em>PCB::stackæ‰€åœ¨åœ°å€(int*)((int)thread+PCB_SIZE)-7</em></p>
<p><em>ä¸‹é¢32-33è¡Œæˆ‘ä»¬å°†PCB</em> nextå€¼å†™å…¥eax,å°†next-&gt;stackçš„å€¼å†™å…¥esp<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨espç”±åŸæ¥çº¿ç¨‹çš„stackåˆ‡æ¢ä¸ºäº†next-&gt;stack.</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714908742419.png" alt="1714908742419"></p>
<p>é€šè¿‡è°ƒè¯•è¿‡ç¨‹æ¥å…·ä½“è§‚å¯Ÿä¸€ä¸‹ï¼š<br>åˆå§‹æ—¶espä¸º0x7bc0,</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714840614902.png" alt="1714840614902"></p>
<p>33è¡Œä¹‹åï¼Œå¯ä»¥çœ‹åˆ°espçš„å€¼å˜æˆäº†thread1çš„stackçš„åœ°å€,æ¥ç€36è¡Œåˆ°39è¡Œå¼¹å‡ºthread1çš„æ ˆä¸­å†…å®¹ï¼ˆå…¨éƒ½æ˜¯0ï¼‰åˆ°å››ä¸ªå¯„å­˜å™¨ä¸­ã€‚å› ä¸ºç°åœ¨çš„espå·²ç»å˜æˆäº†thread1çš„stack,è¿”å›åœ°å€ä¹Ÿæ˜¯å‡½æ•°first_threadçš„é¦–åœ°å€ã€‚retæ‰§è¡Œåå°±è·³è½¬åˆ°äº†first_threadå‡½æ•°ã€‚ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…ˆpop4ä¸ª0åˆ°å¯„å­˜å™¨ï¼Œç„¶åè¿”å›ï¼Œè¿”å›åœ°å€æ˜¯functionçš„åœ°å€ï¼‰</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714909688608.png" alt="1714909688608"><br><img src="/2024/04/22/oslab5/oslab5/1714909446513.png" alt="1714909446513"><br>ç„¶åæˆ‘ä»¬ä¾¿è¿›å…¥äº†first_thread<br><img src="/2024/04/22/oslab5/oslab5/1714909863122.png" alt="1714909863122"></p>
<h4 id="3-2ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«ä¸­æ–­ç„¶åè¢«æ¢ä¸‹å¤„ç†å™¨çš„ï¼Œä»¥åŠæ¢ä¸Šå¤„ç†å™¨ååˆæ˜¯å¦‚ä½•ä»è¢«ä¸­æ–­ç‚¹å¼€å§‹æ‰§è¡Œçš„"><a href="#3-2ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«ä¸­æ–­ç„¶åè¢«æ¢ä¸‹å¤„ç†å™¨çš„ï¼Œä»¥åŠæ¢ä¸Šå¤„ç†å™¨ååˆæ˜¯å¦‚ä½•ä»è¢«ä¸­æ–­ç‚¹å¼€å§‹æ‰§è¡Œçš„" class="headerlink" title="3.2ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«ä¸­æ–­ç„¶åè¢«æ¢ä¸‹å¤„ç†å™¨çš„ï¼Œä»¥åŠæ¢ä¸Šå¤„ç†å™¨ååˆæ˜¯å¦‚ä½•ä»è¢«ä¸­æ–­ç‚¹å¼€å§‹æ‰§è¡Œçš„?"></a>3.2ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«ä¸­æ–­ç„¶åè¢«æ¢ä¸‹å¤„ç†å™¨çš„ï¼Œä»¥åŠæ¢ä¸Šå¤„ç†å™¨ååˆæ˜¯å¦‚ä½•ä»è¢«ä¸­æ–­ç‚¹å¼€å§‹æ‰§è¡Œçš„?</h4><p>ç°åœ¨æˆ‘ä»¬ç€é‡å…³æ³¨RRæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦çš„è¿‡ç¨‹ï¼Œé¦–å…ˆåœ¨ä¸­æ–­å¤„ç†å‡½æ•°å¤„è®¾ç½®æ–­ç‚¹ï¼š</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714910381025.png" alt="1714910381025"></p>
<p>è§‚å¯Ÿcur-&gt;tickså’Œcur-&gt;ticksPassedByçš„å˜åŒ–<br><img src="/2024/04/22/oslab5/oslab5/1714910209537.png" alt="1714910209537"></p>
<p>æ¯ä¸€æ¬¡å‘ç”Ÿæ—¶é’Ÿä¸­æ–­æ—¶ï¼Œä¸­æ–­å¤„ç†å‡½æ•°éƒ½ä¼šå°†å½“å‰è¿›ç¨‹PCBçš„ticks-1,ticksPassedBy+1,å½“cur-&gt;ticksä¸º0æ—¶è¿›è¡Œè¿›ç¨‹åˆ‡æ¢ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è§‚å¯Ÿè¿™ä¸ªè¿›ç¨‹å¦‚ä½•è¢«æ¢ä¸‹å¤„ç†å™¨ã€‚æ—¶é—´ç‰‡ç”¨å®Œåè¿›è¡Œè°ƒåº¦ï¼Œè¿›å…¥scheduleå‡½æ•°å†…éƒ¨ï¼Œå› ä¸ºå½“å‰è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨readyé˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œå¹¶å°†ticksé‡ç½®ã€‚</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714911275547.png" alt="1714911275547"></p>
<p>æ¥ç€è·å–readyé˜Ÿåˆ—çš„å¤´ä¸€ä¸ªå…ƒç´ ï¼Œç®€å•åšä¸€äº›å˜é‡çš„ä¿®æ”¹åï¼ŒæŠŠreadyé˜Ÿåˆ—å¤´popå‡ºæ¥ï¼Œæ¥ç€æˆ‘ä»¬åˆè¿›å…¥äº†asm_swith_thread(cur,next)</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714911725209.png" alt="1714911725209"></p>
<p>è¿›è¡Œçº¿ç¨‹æ ˆçš„åˆ‡æ¢ï¼Œretåè¿”å›second_thread.</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714912484030.png" alt="1714912484030"></p>
<p>thread1å·²ç»è¢«æ¢ä¸‹å¤„ç†å™¨äº†ï¼Œthread1ä¸‹ä¸€æ¬¡è¢«æ¢ä¸Šå¤„ç†å™¨æ˜¯å…·ä½“å¦‚ä½•æ‰§è¡Œçš„å‘¢?</p>
<p>thread3çš„æ—¶é—´ç‰‡ç”¨å®Œä»¥åï¼Œè¿›å…¥sceduleå‡½æ•°ï¼Œè°ƒç”¨asm_swith_thread(cur,next),æ­¤æ—¶çš„nextæŒ‡å‘çš„æ˜¯thread1,å› ä¸ºthread1å·²ç»ä¸æ˜¯æ–°çš„è¿›ç¨‹äº†ï¼Œæ­¤æ—¶å®ƒçš„ebpä¸ä¸º0.</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714913439195.png" alt="1714913439195"></p>
<p>æ³¨æ„åˆ°ï¼Œè¿™é‡Œå‡½æ•°è¿”å›åœ°å€132695æ˜¯scheduleå‡½æ•°ä¸­è°ƒç”¨asm_swith_thread(cur,next)è¯­å¥çš„åœ°å€ï¼Œè°ƒç”¨å®Œè¯¥å‡½æ•°åè¿”å›åŸæ¥ä½ç½®ã€‚ç„¶åscheduleå‡½æ•°æ‰§è¡Œå®Œï¼Œç»§ç»­æ‰§è¡Œå®Œä»–æ‰€åœ¨çš„c_time_interrupt_handleåè¿”å›asm_time_interrupt_handleï¼Œè¯¥å‡½æ•°iretåè¿”å›äº†thread1æ‰§è¡Œåˆ°çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯asm_haltä¸­çš„æ­»å¾ªç¯ã€‚</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714913635709.png" alt="1714913635709"></p>
<p><img src="/2024/04/22/oslab5/oslab5/1714914114783.png" alt="1714914114783"></p>
<h3 id="Assignment-4"><a href="#Assignment-4" class="headerlink" title="Assignment 4"></a>Assignment 4</h3><p>4.1FIFO</p>
<p>ç›¸æ¯”äºassignment23ä¿®æ”¹äº†ï¼š</p>
<p>c_time_interrupt_handler()ä¸­æŠŠé˜Ÿcur-&gt;ticksçš„å¤„ç†å…¨éƒ½å»æ‰</p>
<p>çº¿ç¨‹éƒ½æ²¡æœ‰æ­»å¾ªç¯</p>
<p>void program_exit()ä¸­å¦‚æœreadyé˜Ÿåˆ—éç©ºåˆ™è¿›è¡Œè°ƒåº¦ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!programManager.readyPrograms.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">    programManager.<span class="built_in">schedule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœè§å®éªŒç»“æœ</p>
<p>4.1ä¼˜å…ˆçº§è°ƒåº¦</p>
<p>åœ¨ProgramManager::schedule()å‡½æ•°ä¸­æ‰¾å½“å‰readyé˜Ÿåˆ—ä¼˜å…ˆçº§æœ€å¤§çš„ä»»åŠ¡ï¼Œå…·ä½“ä»£ç è§å…³é”®ä»£ç éƒ¨åˆ†</p>
<p>å°†thread1,2,3çš„ä¼˜å…ˆçº§åˆ†åˆ«è®¾ç½®ä¸º1,2,3,é‚£ä¹ˆä¼šä¾æ¬¡æ‰§è¡Œthread3,2,1,ç»“æœè§å®éªŒç»“æœéƒ¨åˆ†</p>
<h2 id="3-å…³é”®ä»£ç "><a href="#3-å…³é”®ä»£ç " class="headerlink" title="3. å…³é”®ä»£ç "></a>3. <strong>å…³é”®ä»£ç </strong></h2><h3 id="Assignment1"><a href="#Assignment1" class="headerlink" title="Assignment1"></a>Assignment1</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;f&#x27;</span>:&#123;</span><br><span class="line">                <span class="comment">// æ¥æ”¶æµ®ç‚¹å‹ ä¿ç•™6ä¸ºå°æ•°ï¼Œä¸é‡‡å–å››èˆäº”å…¥</span></span><br><span class="line">                <span class="type">float</span> ArgFloVal = <span class="built_in">va_arg</span>(ap, <span class="type">double</span>);</span><br><span class="line">                <span class="keyword">if</span> (ArgFloVal &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    counter += <span class="built_in">printf_add_to_buffer</span>(buffer, <span class="string">&#x27;-&#x27;</span>, idx, BUF_LEN);</span><br><span class="line">                    ArgFloVal = -ArgFloVal;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">unsigned</span> <span class="type">long</span> val_seg = (<span class="type">unsigned</span> <span class="type">long</span>)ArgFloVal;<span class="comment">// å–æ•´æ•°éƒ¨åˆ†</span></span><br><span class="line">                <span class="type">unsigned</span> <span class="type">long</span> val_temp = val_seg;      <span class="comment">// ä¸´æ—¶ä¿å­˜æ•´æ•°éƒ¨åˆ†æ•°æ®</span></span><br><span class="line">                ArgFloVal = ArgFloVal - val_seg;<span class="comment">// å¾—å‡ºä½™ä¸‹çš„å°æ•°éƒ¨åˆ†</span></span><br><span class="line">                <span class="comment">// è®¡ç®—æ•´æ•°éƒ¨åˆ†é•¿åº¦</span></span><br><span class="line">                <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (val_seg)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">while</span> (val_seg) &#123;</span><br><span class="line">                        cnt++;</span><br><span class="line">                        val_seg /= <span class="number">10</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> cnt = <span class="number">1</span>;<span class="comment">// æ•°å­—0çš„é•¿åº¦ä¸º1</span></span><br><span class="line">                <span class="comment">//counter += cnt;// å­—ç¬¦ä¸ªæ•°åŠ ä¸Šæ•´æ•°çš„é•¿åº¦</span></span><br><span class="line">                <span class="comment">// å°†æ•´æ•°è½¬ä¸ºå•ä¸ªå­—ç¬¦æ‰“å°</span></span><br><span class="line">                <span class="keyword">while</span> (cnt)</span><br><span class="line">                &#123;</span><br><span class="line">                    val_seg = val_temp / <span class="built_in">m_pow_n</span>(<span class="number">10</span>, cnt - <span class="number">1</span>);</span><br><span class="line">                    val_temp %= <span class="built_in">m_pow_n</span>(<span class="number">10</span>, cnt - <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">//my_send_char((char)val_seg + &#x27;0&#x27;);</span></span><br><span class="line">                    counter += <span class="built_in">printf_add_to_buffer</span>(buffer, (<span class="type">char</span>)val_seg + <span class="string">&#x27;0&#x27;</span>, idx, BUF_LEN);</span><br><span class="line">                    cnt--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ‰“å°å°æ•°ç‚¹</span></span><br><span class="line">                counter += <span class="built_in">printf_add_to_buffer</span>(buffer,<span class="string">&#x27;.&#x27;</span>, idx, BUF_LEN);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¼€å§‹è¾“å‡ºå°æ•°éƒ¨åˆ†</span></span><br><span class="line">                ArgFloVal *= <span class="number">1000000</span>;</span><br><span class="line">                <span class="comment">// printf(&quot;\r\n %f\r\n&quot;, ArgFloVal);</span></span><br><span class="line">                cnt = <span class="number">6</span>;</span><br><span class="line">                val_temp = (<span class="type">int</span>)ArgFloVal;<span class="comment">// å–æ•´æ•°éƒ¨åˆ†</span></span><br><span class="line">                <span class="keyword">while</span> (cnt)</span><br><span class="line">                &#123;</span><br><span class="line">                    val_seg = val_temp / <span class="built_in">m_pow_n</span>(<span class="number">10</span>, cnt - <span class="number">1</span>);</span><br><span class="line">                    val_temp %= <span class="built_in">m_pow_n</span>(<span class="number">10</span>, cnt - <span class="number">1</span>);</span><br><span class="line">                    counter += <span class="built_in">printf_add_to_buffer</span>(buffer, (<span class="type">char</span>)val_seg + <span class="string">&#x27;0&#x27;</span>, idx, BUF_LEN);</span><br><span class="line">                    <span class="comment">//my_send_char((char)val_seg + &#x27;0&#x27;);</span></span><br><span class="line">                    cnt--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//ret_num += 6;</span></span><br><span class="line">                <span class="comment">//pStr++;</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:&#123;</span><br><span class="line">             <span class="type">int</span> temp = <span class="built_in">va_arg</span>(ap, <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (temp &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    counter += <span class="built_in">printf_add_to_buffer</span>(buffer, <span class="string">&#x27;-&#x27;</span>, idx, BUF_LEN);</span><br><span class="line">                    temp = -temp;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">itos</span>(number, temp, <span class="number">10</span> );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; number[j]; ++j)</span><br><span class="line">                &#123;</span><br><span class="line">                    counter += <span class="built_in">printf_add_to_buffer</span>(buffer, number[j], idx, BUF_LEN);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:&#123;</span><br><span class="line">                <span class="type">int</span> temp = <span class="built_in">va_arg</span>(ap, <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (temp &lt; <span class="number">0</span> &amp;&amp; fmt[i] == <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    counter += <span class="built_in">printf_add_to_buffer</span>(buffer, <span class="string">&#x27;-&#x27;</span>, idx, BUF_LEN);</span><br><span class="line">                    temp = -temp;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">itos</span>(number, temp, (fmt[i] == <span class="string">&#x27;d&#x27;</span> ? <span class="number">10</span> : <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; number[j]; ++j)</span><br><span class="line">                &#123;</span><br><span class="line">                    counter += <span class="built_in">printf_add_to_buffer</span>(buffer, number[j], idx, BUF_LEN);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Assignment3"><a href="#Assignment3" class="headerlink" title="Assignment3"></a>Assignment3</h3><p>ä»£ç çš„è§£é‡Šè§å®éªŒè¿‡ç¨‹éƒ¨åˆ†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">asm_switch_thread:</span><br><span class="line">    push ebp</span><br><span class="line">    push ebx</span><br><span class="line">    push edi</span><br><span class="line">    push esi</span><br><span class="line"></span><br><span class="line">    mov eax, [esp + 5 * 4]</span><br><span class="line">    mov [eax], esp ; ä¿å­˜å½“å‰æ ˆæŒ‡é’ˆåˆ°PCBä¸­ï¼Œä»¥ä¾¿æ—¥åæ¢å¤</span><br><span class="line"></span><br><span class="line">    mov eax, [esp + 6 * 4]</span><br><span class="line">    mov esp, [eax] ; æ­¤æ—¶æ ˆå·²ç»ä»curæ ˆåˆ‡æ¢åˆ°nextæ ˆ</span><br><span class="line"></span><br><span class="line">    pop esi</span><br><span class="line">    pop edi</span><br><span class="line">    pop ebx</span><br><span class="line">    pop ebp</span><br><span class="line"></span><br><span class="line">    sti</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>

<h3 id="Assignment-4-1"><a href="#Assignment-4-1" class="headerlink" title="Assignment 4"></a>Assignment 4</h3><p>ä¼˜å…ˆçº§è°ƒåº¦</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ProgramManager::schedule</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> status = interruptManager.<span class="built_in">getInterruptStatus</span>();</span><br><span class="line">    interruptManager.<span class="built_in">disableInterrupt</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (readyPrograms.<span class="built_in">size</span>() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        interruptManager.<span class="built_in">setInterruptStatus</span>(status);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (running-&gt;status == ProgramStatus::RUNNING)</span><br><span class="line">    &#123;</span><br><span class="line">        running-&gt;status = ProgramStatus::READY;</span><br><span class="line">        running-&gt;ticks = running-&gt;priority * <span class="number">10</span>;</span><br><span class="line">        readyPrograms.<span class="built_in">push_back</span>(&amp;(running-&gt;tagInGeneralList));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (running-&gt;status == ProgramStatus::DEAD)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">releasePCB</span>(running);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–max,next,nextid,readyé˜Ÿåˆ—çš„size</span></span><br><span class="line">    <span class="type">int</span> max = <span class="number">-1</span>;</span><br><span class="line">    PCB* next = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="type">int</span> nextid = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> size = readyPrograms.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">//æ‰¾åˆ°ä¼˜å…ˆçº§æœ€å¤§çš„çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">        ListItem* item = readyPrograms.<span class="built_in">at</span>(i);</span><br><span class="line">        PCB* tmp = <span class="built_in">ListItem2PCB</span>(item, tagInGeneralList);</span><br><span class="line">        <span class="keyword">if</span>(tmp-&gt;priority &gt; max)&#123;</span><br><span class="line">            max = tmp-&gt;priority;</span><br><span class="line">            nextid = i;</span><br><span class="line">            next = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ListItem *item = readyPrograms.front();</span></span><br><span class="line">    <span class="comment">//PCB *next = ListItem2PCB(item, tagInGeneralList);</span></span><br><span class="line">    <span class="comment">//ä»readyé˜Ÿåˆ—ä¸­å–å‡ºï¼Œå°†è¯¥çº¿ç¨‹çŠ¶æ€ç½®ä¸ºrunning</span></span><br><span class="line">    PCB *cur = running;</span><br><span class="line">    next-&gt;status = ProgramStatus::RUNNING;</span><br><span class="line">    running = next;</span><br><span class="line">    readyPrograms.<span class="built_in">erase</span>(nextid);</span><br><span class="line">    <span class="comment">//åˆ‡æ¢çº¿ç¨‹æ ˆï¼Œå®ç°çº¿ç¨‹çš„åˆ‡æ¢</span></span><br><span class="line">    <span class="built_in">asm_switch_thread</span>(cur, next);</span><br><span class="line"></span><br><span class="line">    interruptManager.<span class="built_in">setInterruptStatus</span>(status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-å®éªŒç»“æœ"><a href="#4-å®éªŒç»“æœ" class="headerlink" title="4. å®éªŒç»“æœ"></a>4. <strong>å®éªŒç»“æœ</strong></h2><h4 id="Assignment1-1"><a href="#Assignment1-1" class="headerlink" title="Assignment1:"></a>Assignment1:</h4><p>printf %bï¼ˆäºŒè¿›åˆ¶ï¼‰å’Œ%f(ä¿ç•™å…­ä½å°æ•°)</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714908659141.png" alt="1714908659141"></p>
<h4 id="Assignment2"><a href="#Assignment2" class="headerlink" title="Assignment2:"></a>Assignment2:</h4><p><img src="/2024/04/22/oslab5/oslab5/1714919664301.png" alt="1714919664301"></p>
<h4 id="Assignment3-1"><a href="#Assignment3-1" class="headerlink" title="Assignment3:"></a>Assignment3:</h4><p>è§å®éªŒè¿‡ç¨‹éƒ¨åˆ†</p>
<h4 id="Assignment4"><a href="#Assignment4" class="headerlink" title="Assignment4:"></a>Assignment4:</h4><p>4.1 FIFO</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714917101307.png" alt="1714917101307"></p>
<p>4.2 ä¼˜å…ˆçº§è°ƒåº¦</p>
<p><img src="/2024/04/22/oslab5/oslab5/1714917971082.png" alt="1714917971082"></p>
<h2 id="5-å®éªŒæ€»ç»“"><a href="#5-å®éªŒæ€»ç»“" class="headerlink" title="5.å®éªŒæ€»ç»“"></a>5.å®éªŒæ€»ç»“</h2><p>é€šè¿‡è¿™æ¬¡å®éªŒï¼Œå­¦ä¹ äº†å¯å˜å‚æ•°æœºåˆ¶ï¼Œå¹¶å¢æ·»äº†å®éªŒä¸­çš„pringfå‡½æ•°çš„åŠŸèƒ½ï¼Œçº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­çš„æè¿°ï¼Œè°ƒåº¦æ–¹å¼ã€‚å¤ç°å®éªŒå¾ˆå®¹æ˜“ï¼Œä½†è¦æ·±å…¥ç†è§£å…¶ä¸­çš„æ¯ä¸€å¤„ç»†èŠ‚å¹¶å‡†ç¡®æè¿°å‡ºæ¥å¾ˆéš¾ã€‚æˆ‘åœ¨Assignment3ä¸­å¼€å§‹ç”±äºå¯¹å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­æ ˆçš„å˜åŒ–ä¸ç†Ÿæ‚‰å¡äº†å¾ˆä¹…ï¼Œåæ¥çœ‹åˆ°å…¶ä»–åŒå­¦çš„è§£é‡Šæ—¶æ‰æ›´åŠ æ·±å…¥ç†è§£äº† <code>asm_switch_thread</code>çš„è®¾è®¡,æ„Ÿå—åˆ°äº†è®¾è®¡çš„å·§å¦™ä¹‹å¤„ã€‚</p>
<!--åœ¨src/kernel/pragram.cppæ–‡ä»¶ä¸­ï¼Œä¼ å‚ä¸ºnullptrçš„ä½œç”¨ï¼Ÿ

ä¸ºä»€ä¹ˆä¼šè¿”å›schedule-->

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/04/07/oslab3/" rel="prev" title="SYSU-2024æ“ä½œç³»ç»Ÿlab3å®éªŒ">
      <i class="fa fa-chevron-left"></i> SYSU-2024æ“ä½œç³»ç»Ÿlab3å®éªŒ
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/05/06/oslab6/" rel="next" title="">
       <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#author-zyh"><span class="nav-number">1.</span> <span class="nav-text">author:zyh</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%90%8D%E7%A7%B0-Lab5-%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B"><span class="nav-number"></span> <span class="nav-text">å®éªŒåç§°:          Lab5 å†…æ ¸çº¿ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%AE%9E%E9%AA%8C%E8%A6%81%E6%B1%82"><span class="nav-number">1.</span> <span class="nav-text">1. å®éªŒè¦æ±‚</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-1-printf%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.1.</span> <span class="nav-text">Assignment 1 printfçš„å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-2-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.2.</span> <span class="nav-text">Assignment 2 çº¿ç¨‹çš„å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-3-%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%88%87%E6%8D%A2%E7%9A%84%E7%A7%98%E5%AF%86"><span class="nav-number">1.3.</span> <span class="nav-text">Assignment 3 çº¿ç¨‹è°ƒåº¦åˆ‡æ¢çš„ç§˜å¯†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E5%BF%85%E5%81%9A%E4%B8%8E%E9%80%89%E5%81%9A%EF%BC%89Assignment-4-%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.4.</span> <span class="nav-text">ï¼ˆå¿…åšä¸é€‰åšï¼‰Assignment 4 è°ƒåº¦ç®—æ³•çš„å®ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">2. å®éªŒè¿‡ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-1"><span class="nav-number">2.1.</span> <span class="nav-text">Assignment 1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E6%9C%BA%E5%88%B6"><span class="nav-number">2.1.1.</span> <span class="nav-text">1.1å¯å˜å‚æ•°æœºåˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E5%AE%9E%E7%8E%B0printf%E5%A2%9E%E5%8A%A0-b%E5%92%8C-f%E5%8A%9F%E8%83%BD"><span class="nav-number">2.1.2.</span> <span class="nav-text">1.2 å®ç°printfå¢åŠ %bå’Œ%fåŠŸèƒ½</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-2"><span class="nav-number">2.2.</span> <span class="nav-text">Assignment 2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%8F%8F%E8%BF%B0"><span class="nav-number">2.2.1.</span> <span class="nav-text">çº¿ç¨‹çš„æè¿°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%EF%BC%9A"><span class="nav-number">2.2.2.</span> <span class="nav-text">çº¿ç¨‹çš„åˆ›å»ºï¼š</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-3"><span class="nav-number">2.3.</span> <span class="nav-text">Assignment 3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1%E4%B8%80%E4%B8%AA%E6%96%B0%E5%88%9B%E5%BB%BA%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%98%AF%E5%A6%82%E4%BD%95%E8%A2%AB%E8%B0%83%E5%BA%A6%E7%84%B6%E5%90%8E%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C"><span class="nav-number">2.3.1.</span> <span class="nav-text">3.1ä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«è°ƒåº¦ç„¶åå¼€å§‹æ‰§è¡Œ?</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2%E4%B8%80%E4%B8%AA%E6%AD%A3%E5%9C%A8%E6%89%A7%E8%A1%8C%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%98%AF%E5%A6%82%E4%BD%95%E8%A2%AB%E4%B8%AD%E6%96%AD%E7%84%B6%E5%90%8E%E8%A2%AB%E6%8D%A2%E4%B8%8B%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%84%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%8D%A2%E4%B8%8A%E5%A4%84%E7%90%86%E5%99%A8%E5%90%8E%E5%8F%88%E6%98%AF%E5%A6%82%E4%BD%95%E4%BB%8E%E8%A2%AB%E4%B8%AD%E6%96%AD%E7%82%B9%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C%E7%9A%84"><span class="nav-number">2.3.2.</span> <span class="nav-text">3.2ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ˜¯å¦‚ä½•è¢«ä¸­æ–­ç„¶åè¢«æ¢ä¸‹å¤„ç†å™¨çš„ï¼Œä»¥åŠæ¢ä¸Šå¤„ç†å™¨ååˆæ˜¯å¦‚ä½•ä»è¢«ä¸­æ–­ç‚¹å¼€å§‹æ‰§è¡Œçš„?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-4"><span class="nav-number">2.4.</span> <span class="nav-text">Assignment 4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81"><span class="nav-number">3.</span> <span class="nav-text">3. å…³é”®ä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment1"><span class="nav-number">3.1.</span> <span class="nav-text">Assignment1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment3"><span class="nav-number">3.2.</span> <span class="nav-text">Assignment3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assignment-4-1"><span class="nav-number">3.3.</span> <span class="nav-text">Assignment 4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="nav-number">4.</span> <span class="nav-text">4. å®éªŒç»“æœ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Assignment1-1"><span class="nav-number">4.0.1.</span> <span class="nav-text">Assignment1:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Assignment2"><span class="nav-number">4.0.2.</span> <span class="nav-text">Assignment2:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Assignment3-1"><span class="nav-number">4.0.3.</span> <span class="nav-text">Assignment3:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Assignment4"><span class="nav-number">4.0.4.</span> <span class="nav-text">Assignment4:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">5.å®éªŒæ€»ç»“</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zyh</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zyh</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
